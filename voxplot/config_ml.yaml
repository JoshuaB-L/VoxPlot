# ML-Enhanced VoxPlot Analysis Configuration
# ==========================================
# Configuration for machine learning enhanced analysis of 3D forest structure data
# Includes clustering, dimensionality reduction, spatial pattern analysis, and model comparison

analysis:
  # Basic analysis parameters
  crown_base_height: 1.5          # Height threshold for crown base (meters)
  voxel_size: 0.25                # Voxel resolution (meters)
  min_density: 0.001              # Minimum density threshold for analysis
  output_dir: "ml_analysis_results"  # Output directory for all results
  
  # Comparison mode for ML analysis
  # Options: same_density_type_same_model_type, same_density_type_different_model_type,
  #          different_density_type_same_model_type, different_density_type_different_model_type
  comparison_mode: "different_density_type_different_model_type"
  
  # Density types to analyze
  density_types: ["lad", "wad", "pad"]
  
  # Height stratification parameters
  height_layers:
    lower_percentile: 33           # Lower crown layer (0-33rd percentile)
    upper_percentile: 67           # Upper crown layer (67th-100th percentile)
  
  # ML analysis parameters
  ml_analysis:
    # Sampling configuration for performance optimization
    enable_sampling: true          # Enable intelligent sampling for large datasets
    max_sample_size: 10000         # Maximum number of voxels to sample per model
    sampling_strategy: "stratified_spatial"  # Options: "random", "stratified_spatial", "density_aware", "height_stratified"
    random_seed: 42               # Random seed for reproducible results
    
    # Performance optimization settings
    performance:
      # Compute backend selection
      compute_backend: "gpu"       # Options: "cpu", "gpu", "auto"
      use_gpu_acceleration: true  # Enable CUDA acceleration where available
      n_jobs: -1                   # Number of parallel jobs (-1 for all cores)
      
      # Memory optimization
      data_type_optimization: true # Use float32 instead of float64 for memory efficiency
      chunk_processing: true      # Enable chunked processing for very large datasets
      chunk_size: 50000           # Voxels per chunk when chunk_processing enabled

# ML Analysis Configuration
ml_config:
  # Clustering analysis settings
  clustering:
    # K-Means clustering configuration
    kmeans:
      # Algorithm selection
      algorithm: "auto"                    # Options: "standard", "mini_batch", "gpu_accelerated", "auto"
      cluster_range: [3, 5, 8, 12, 15]  # Range of cluster numbers to test
      
      # Standard K-Means parameters
      n_init: 10                    # Number of random initializations
      max_iter: 300                 # Maximum iterations
      
      # Mini-Batch K-Means parameters (when algorithm="mini_batch")
      batch_size: 1000              # Batch size for mini-batch K-means
      max_no_improvement: 10        # Early stopping parameter
      
      # GPU acceleration parameters (when algorithm="gpu_accelerated")
      gpu_memory_fraction: 0.8      # Fraction of GPU memory to use
      
    # DBSCAN clustering  
    dbscan:
      eps_values: [0.5, 1.0, 2.0, 3.0]     # Epsilon values to test
      min_samples: [5, 10, 15, 20]         # Minimum samples values to test
      
    # Hierarchical clustering
    hierarchical:
      enable: true
      linkage_methods: ['ward', 'complete', 'average']
      n_clusters_range: [3, 5, 8, 12]
  
  # Dimensionality reduction settings
  dimensionality_reduction:
    # PCA settings
    pca:
      n_components: [2, 3, 5, 10]   # Number of components to test
      enable_explained_variance: true
      
    # t-SNE settings
    tsne:
      n_components: 2               # Number of t-SNE components (2D or 3D)
      perplexity: [10, 30, 50]      # Perplexity values to test
      max_iter: 1000               # Maximum iterations
      enable: true                  # Enable t-SNE (can be slow for large datasets)
      
    # UMAP settings (if available)
    umap:
      n_components: 2
      n_neighbors: [15, 30, 50]
      min_dist: 0.1
      enable: true
  
  # Spatial pattern analysis settings  
  spatial_analysis:
    # Density hotspot detection
    hotspot_detection:
      high_density_percentile: 90   # Threshold for high-density regions
      low_density_percentile: 10    # Threshold for low-density regions
      
    # Clumping analysis
    clumping:
      neighborhood_radius: 1.0      # Radius for neighborhood analysis (meters)
      clumping_threshold: 0.1       # Density threshold for clump detection
      
    # Spatial gradient analysis
    gradients:
      enable: true
      gradient_resolution: 1.0      # Resolution for gradient calculation
      
    # Height stratification
    height_analysis:
      layers: ['whole', 'upper', 'middle', 'lower']
      enable_layer_comparison: true
  
  # Physical accuracy assessment
  physical_accuracy:
    # Distribution analysis
    distribution_tests:
      enable_normality_test: true
      enable_outlier_detection: true
      outlier_method: 'iqr'         # 'iqr' or 'zscore'
      
    # Plausibility checks
    plausibility:
      check_negative_densities: true
      check_extreme_values: true
      extreme_value_percentile: 99.9
      
    # Consistency analysis
    consistency:
      enable_spatial_consistency: true
      enable_height_consistency: true
      consistency_radius: 2.0       # Radius for consistency checks
  
  # Occlusion analysis settings
  occlusion_analysis:
    # Shadow detection
    shadow_detection:
      enable: true
      spatial_tolerance: 2.0        # Spatial tolerance for shadow detection (meters)
      density_ratio_threshold: 0.1  # Threshold for shadow identification
      
    # Line-of-sight analysis
    line_of_sight:
      enable: false                 # Computationally intensive
      ray_resolution: 0.5           # Resolution for ray casting
      
    # Correction assessment
    correction_assessment:
      enable_empirical_assessment: true
      zero_density_threshold: 50    # Percentage threshold for poor correction
  
  # Regression and correlation analysis
  regression:
    # Linear regression
    linear_regression:
      enable: true
      
    # Random Forest regression
    random_forest:
      enable: true
      n_estimators: 100
      max_depth: 10
      
    # XGBoost regression (if available)
    xgboost:
      enable: true
      n_estimators: 100
      max_depth: 6
      
    # Cross-validation settings
    cross_validation:
      enable: true
      cv_folds: 5
      scoring: 'r2'
  
  # Model comparison settings
  comparative_analysis:
    # Similarity analysis
    similarity:
      method: 'cosine'              # 'cosine', 'euclidean', 'correlation'
      enable_feature_comparison: true
      
    # Performance ranking
    ranking:
      # Weights for different criteria (must sum to 1.0)
      weights:
        clustering_quality: 0.3
        physical_plausibility: 0.25
        occlusion_correction: 0.25
        spatial_consistency: 0.2
        
      # Ranking methods
      aggregation_method: 'weighted_sum'  # 'weighted_sum', 'rank_aggregation'

# Visualization settings
visualization:
  # Figure settings
  figure_settings:
    dpi: 600                        # High resolution for publications
    format: ['png', 'pdf', 'svg']   # Output formats
    
  # Size settings  
  figsize:
    dashboard_large: [20, 24]       # Large comprehensive dashboard
    dashboard_medium: [16, 12]      # Medium dashboard
    individual_plot: [12, 8]        # Individual analysis plots
    square_plot: [10, 10]          # Square plots (for 3D visualizations)
    
  # Typography
  typography:
    title_fontsize: 24
    subtitle_fontsize: 18
    label_fontsize: 14
    tick_fontsize: 11
    annotation_fontsize: 12
    legend_fontsize: 12
    
  # Color schemes
  colors:
    # Model-specific colors
    model_palette: 
      - "#2E86AB"    # Professional blue (AmapVox)
      - "#A23B72"    # Vibrant magenta (VoxLAD)  
      - "#F18F01"    # Warm orange (VoxPy)
      - "#C73E1D"    # Deep red
      - "#592E83"    # Purple
      - "#1B998B"    # Teal
      
    # Density type colors
    density_colors:
      lad: "#2ECC71"      # Green for leaf area density
      wad: "#8B4513"      # Brown for wood area density
      pad: "#4A90E2"      # Blue for plant area density
      
    # Clustering colors
    cluster_colors:
      - "#FF6B6B"    # Red
      - "#4ECDC4"    # Teal
      - "#45B7D1"    # Blue
      - "#96CEB4"    # Green
      - "#FFEAA7"    # Yellow
      - "#DDA0DD"    # Plum
      - "#98D8C8"    # Mint
      - "#F7DC6F"    # Gold
      
    # Color maps
    sequential_cmap: "viridis"      # For density/height gradients
    diverging_cmap: "RdBu_r"        # For difference/comparison plots
    categorical_cmap: "Set3"        # For categorical data

# Models configuration - Using working file paths from statistical framework
models:
  # AmapVox TLS model
  AmapVox_TLS:
    model_type: "amapvox"
    display_color_index: 0
    description: "Terrestrial LiDAR Beer-Lambert approach"
    file_paths:
      pad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_on/pad/amapvox_tls_merged_pad_unfiltered_transect.csv"
      wad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_off/wad/amapvox_tls_merged_wad_unfiltered_transect.csv"
    
  # AmapVox ULS model  
  AmapVox_ULS:
    model_type: "amapvox"
    display_color_index: 1
    description: "Unmanned LiDAR Beer-Lambert approach"
    file_paths:
      pad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_on/pad/amapvox_pad_uls_transect.csv"
      wad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_off/wad/amapvox_uls_britz_oak_leaf_off_000.csv"
    
  # VoxLAD TLS model
  VoxLAD_TLS:
    model_type: "voxlad"
    display_color_index: 2
    description: "Multi-scan terrestrial LiDAR approach"
    file_paths:
      pad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_on/pad/voxlad_v3_britz_oak_seg_scan_pos_42_43_53_g_plagio_vox_0_25_r_0_00035_pad_transect.txt"
      wad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_off/wad/voxlad_tls_britz_oak_leaf_off_wad_g_erecto_transect.txt"
      lad: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/plots/wad_lad_pad_comp/leaf_on/lad/voxlad_v3_britz_oak_seg_scan_pos_42_43_53_g_plagio_vox_0_25_r_0_00035_lad_transect.txt"
    
  # VoxPy Combined model
  VoxPy_Combined:
    model_type: "voxpy"
    display_color_index: 3
    description: "Direct density method with vertical calibration"
    file_paths:
      use_combined_file: true
      combined: "/mnt/g/My Drive/Bath-Uni/PhD/Structure/Paper-4-PALM-PCM-Study/Code/python/voxpy/model/voxpy-v7_002/voxpy-v7_002_003_enhanced_vertical_calibration_results/voxpy-v7_002_003_enhanced_combined_density.csv"

# Ground truth data (if available for validation)
ground_truth:
  enable: false
  file_path: "ground_truth_data/field_measurements.csv"
  measurements: ["lai", "wai", "pai"]
  height_measurements: true

# Performance and optimization settings
performance:
  # Memory management
  chunk_size: 50000               # Process data in chunks for memory efficiency
  enable_memory_optimization: true
  
  # Parallel processing
  n_jobs: -1                      # Use all available CPU cores (-1)
  enable_parallel: true
  
  # Caching
  enable_caching: true
  cache_directory: ".ml_cache"

# Output settings
output:
  # Export formats
  export_formats:
    enable_csv: true
    enable_excel: true             # Requires openpyxl
    enable_json: true
    enable_hdf5: false             # Requires tables/pytables
    
  # Visualization exports
  figure_formats: ["png", "pdf", "svg"]
  
  # Compression
  enable_compression: true
  compression_format: "gzip"
  
  # Report generation
  generate_report: true
  report_format: "markdown"       # 'markdown', 'html', 'pdf'
  include_technical_details: true

# Logging configuration
logging:
  level: "INFO"                   # DEBUG, INFO, WARNING, ERROR
  enable_file_logging: true
  log_file: "ml_analysis.log"
  max_log_size: "10MB"
  backup_count: 5